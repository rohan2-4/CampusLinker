{% extends "base (1).html" %}

{% block title %}Exam Management - Campus Linker{% endblock %}

{% block content %}
<div class="exam-section">
    <div class="container">
        <div class="page-header">
            <h1>Enter Exam Details</h1>
            <p>Select an exam and choose your subject to take the test</p>
        </div>
        
        <div class="exam-form">
            <form method="POST" action="{{ url_for('exam') }}">
                <div class="form-section">
                    <h2>Your Details</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="student_id">Student ID <span class="required">*</span></label>
                            <input type="number" id="student_id" name="student_id" required value="{{ (student_details.student_id if student_details) or '' }}" {% if student_details %}readonly{% endif %}>
                        </div>
                        <div class="form-group">
                            <label for="course_name">Course Name <span class="required">*</span></label>
                            <input type="text" id="course_name" name="course_name" required value="{{ (student_details.course_name if student_details) or '' }}" {% if student_details %}readonly{% endif %}>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Available Exams</h2>
                    {% if exams_grouped %}
                        <div class="exams-container">
                            {% for exam_name, exam_group in exams_grouped.items() %}
                            <div class="exam-group-card">
                                <div class="exam-group-header">
                                    <h3>{{ exam_name }}</h3>
                                    <span class="subject-count">{{ exam_group.subjects|length }} subject(s)</span>
                                </div>
                                <div class="subjects-list">
                                    {% for subject_exam in exam_group.subjects %}
                                    <div class="subject-option">
                                        <input type="radio" 
                                               id="exam_{{ subject_exam.exam_id }}" 
                                               name="exam_id" 
                                               value="{{ subject_exam.exam_id }}"
                                               data-subject="{{ subject_exam.subject }}"
                                               data-exam-type="{{ subject_exam.exam_type }}"
                                               data-exam-date="{{ subject_exam.exam_date }}"
                                               data-exam-time="{{ subject_exam.exam_time }}"
                                               data-duration="{{ subject_exam.duration }}"
                                               data-max-marks="{{ subject_exam.max_marks }}"
                                               required>
                                        <label for="exam_{{ subject_exam.exam_id }}" class="subject-label">
                                            <strong>{{ subject_exam.subject }}</strong>
                                            <span class="exam-details">
                                                {{ subject_exam.exam_date }} at {{ subject_exam.exam_time }} | 
                                                Duration: {{ subject_exam.duration }} mins | 
                                                Max Marks: {{ subject_exam.max_marks }}
                                            </span>
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <div class="exam-details-display">
                            <h3>Selected Exam Details</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Subject</label>
                                    <input type="text" id="selected_subject" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Exam Type</label>
                                    <input type="text" id="selected_exam_type" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Exam Date</label>
                                    <input type="text" id="selected_exam_date" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Exam Time</label>
                                    <input type="text" id="selected_exam_time" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Duration (mins)</label>
                                    <input type="text" id="selected_duration" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Max Marks</label>
                                    <input type="text" id="selected_max_marks" readonly>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <p class="no-exams-info">No exams are currently available for your course. Please check back later.</p>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" {% if not exams_grouped %}disabled{% endif %}>Submit</button>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.exams-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.exam-group-card {
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    background: #f9f9f9;
    transition: all 0.3s ease;
}

.exam-group-card:hover {
    border-color: #007bff;
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
}

.exam-group-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
}

.exam-group-header h3 {
    margin: 0;
    color: #007bff;
    font-size: 18px;
}

.subject-count {
    background: #007bff;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
}

.subjects-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.subject-option {
    display: flex;
    align-items: flex-start;
    padding: 12px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.subject-option:hover {
    background: #f0f8ff;
    border-color: #007bff;
}

.subject-option input[type="radio"] {
    margin-top: 5px;
    margin-right: 12px;
    cursor: pointer;
    flex-shrink: 0;
}

.subject-label {
    display: flex;
    flex-direction: column;
    gap: 5px;
    cursor: pointer;
    flex: 1;
}

.subject-label strong {
    color: #333;
    font-size: 16px;
}

.exam-details {
    color: #666;
    font-size: 13px;
    font-weight: normal;
}

.exam-details-display {
    background: #f5f5f5;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
    border: 1px solid #ddd;
}

.exam-details-display h3 {
    color: #333;
    margin-top: 0;
    margin-bottom: 15px;
}

.no-exams-info {
    padding: 20px;
    background: #ffe6e6;
    border: 1px solid #ffcccc;
    color: #cc0000;
    border-radius: 6px;
    text-align: center;
    font-weight: 500;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const radioButtons = document.querySelectorAll('input[name="exam_id"]');
    const subjectEl = document.getElementById('selected_subject');
    const typeEl = document.getElementById('selected_exam_type');
    const dateEl = document.getElementById('selected_exam_date');
    const timeEl = document.getElementById('selected_exam_time');
    const durationEl = document.getElementById('selected_duration');
    const maxMarksEl = document.getElementById('selected_max_marks');

    const clearDetails = () => {
        [subjectEl, typeEl, dateEl, timeEl, durationEl, maxMarksEl].forEach((el) => {
            if (el) {
                el.value = '';
            }
        });
    };

    radioButtons.forEach(radio => {
        radio.addEventListener('change', function () {
            if (!this.checked) {
                clearDetails();
                return;
            }

            if (subjectEl) subjectEl.value = this.dataset.subject || '';
            if (typeEl) typeEl.value = this.dataset.examType || '';
            if (dateEl) dateEl.value = this.dataset.examDate || '';
            if (timeEl) timeEl.value = this.dataset.examTime || '';
            if (durationEl) durationEl.value = this.dataset.duration || '';
            if (maxMarksEl) maxMarksEl.value = this.dataset.maxMarks || '';
        });
    });
});
</script>
{% endblock %}